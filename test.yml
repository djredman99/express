jobs:
- job: Windows_MustPass
  strategy:
    maxParallel: 10
    matrix:
      Node 1.8:
        NODE_VERSION: '1.8'

  continueOnError: false
  pool:
    vmImage: 'vs2017-win2016'

  steps:
  # - task: NodeTool@0
  #  displayName: "Use Node $(NODE_VERSION)"
  #  inputs:
  #    versionSpec: $(NODE_VERSION)
  #    checkLatest: true

  - powershell: |
      Push-Location env:
      (ls path).value.split(";")
      Pop-Location
      $iojsUrl = "https://iojs.org/dist/v1.8.4/iojs-v1.8.4-x64.msi"
      $file = Join-Path "$(agent.tempDirectory)" "mickey.msi"
      Invoke-WebRequest -Uri $iojsUrl -OutFile $file
      #$x = (Join-Path "$(agent.tempDirectory)" "tmp")
      dir $(agent.tempDirectory)
      $mypath = "c:\Program Files\iojs"
      $mypath
      Start-Process msiexec.exe -Wait -ArgumentList "/I $file /quiet"
      [Environment]::SetEnvironmentVariable('PATH', $env:Path + ";$mypath", [EnvironmentVariableTarget]::Machine)
      Push-Location env:
      (ls path).value.split(";")
      Pop-Location

  - powershell: |
      $env:Path
      node --version

